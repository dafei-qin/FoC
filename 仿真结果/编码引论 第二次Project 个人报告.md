# 编码引论 第二次Project 个人报告

*小组成员：马泽余 陈森睿 秦达飞*

*本部分撰写人：陈森睿*

*主要内容：信道编码参数设计、误码性能理论推导与仿真分析、波形信道设计与仿真*

## 整体概括

本次实验中，......

我们的主要工作包括：......

本报告汇报我的工作，主要包括......

## 编码参数设计

### 任务

* $300\sim3400Hz$带通信道，AGWN噪声
* 线性传输，收发端采用滚降系数$\alpha=0.5$根号升余弦滤波
* 待传数据大小1kB，要求5秒内完成传输
* 要求：设计编码参数（进制数、符号率、卷积码效率等）

### 分析

设定符号率$R_s$，调制比特数$M$。传输速率$R_b=MR_s$应满足
$$
R_b=MR_s\ge1600 \ \mathbb{bits}/\mathbb{sec} \tag{1.1}
$$
可利用的带宽$B=3100Hz$，因此复基带成型滤波器对应的单边带宽应满足$B_s\le1550Hz$。而成型滤波器为根号升余弦，带宽$B_s=\frac{1+\alpha}{2}R_s$，因此
$$
\frac{1+\alpha}{2}R_s\le\dfrac12B\tag{1.2}
$$
得出$Rs\le2066Hz$，据此可以设计$(M,R_s)$如下。我们的设计思路是：尽可能用尽5秒，以换取频带资源的节省。

| M (bits/symbol) | $R_s$ (Hz) | 传输速率$R_b$(bit/sec) |  占用频段 (Hz)   |
| :-------------: | ---------- | :--------------------: | :--------------: |
|        1        | 1665.0     |          1665          | [1017.5, 2682.5] |
|        2        | 832.5      |          1665          | [1433.8, 2266.3] |
|        3        | 555.0      |          1665          | [1572.5, 2127.5] |

**有卷积编码的情况：** 卷积编码可以降低通信过程的误码率。设卷积编码效率为$R_c$，则(1.1)改为
$$
R_b = R_cR_sM\ge1600 \ \mathbb{bits} \tag{1.1}
$$
其他要求不变。设计如下：

| M (bits/symbol) | $R_s$ (Hz) | $R_c$ | 传输速率(bit/sec) | 占用频段 (Hz)    |
| :-------------: | :----: | :---------------: | :--------------: | :--------------: |
| 2               | 1665.0 | 1/2           | 1665              | [1433.8, 2266.3] |
| 3               | 1665.0 | 1/3           | 1665              | [1572.5, 2127.5] |



## 波形信道

本部分讨论波形信道部份的设计、并仿真给出信号波形、功率谱、误码性能等

### 架构

波形信道的整体架构如下图

![](C:\学习资料\_编码引论\project2\FoC\仿真结果\波形信道.jpg)

单独划分出波形信道，使得系统更加模块化，带来若干好处：一方面，上一次作业完成的电平信道可以很容易地与之联接（只需调整好输出电平大小）；另一方面，卷积码、安全编码模块与信道解耦，便于独立设计。

### 实现

#### 0.全局参数

我选取采样率$f_{real}=33300Hz$来刻画波形。程序中，方便起见，将采样率归一化。

以 [$M=1$，$R_s=1665Hz$，无卷积] 的参数为例：程序中`Rs=1/20`，载波中心频率`fc=1/18`



#### 1.成型滤波

为获得根号升余弦滤波器，先根据$R_s$得到根升的频谱，再用傅里叶逆变换回到时域。

```matlab
Gc = 1.*(abs(f)<=Rs/4) + 0.5*(1+sin(2*pi/Rs*abs(f))).*(abs(f)>Rs/4 & abs(f)<=3*Rs/4); %升余弦频谱
Gs = sqrt(Gc);%根升
g = (IFT*Gs)';%逆变换到时域
```

其中`IFT`矩阵由`prefourier`函数获得。注意`prefourier`中的时域采样率必须为1（即`g`对应采样率为1）。

*注：时频变换最好用 `fft`，可以避免采样率的麻烦，效率也更高。*

利用`g`进行成型滤波。设电平信道给出复电平序列`a`，则成型滤波后的复基带信号为
$$
S_B(t)=\sum_na_ng(t-nT_s)
$$
其中$T_s=\cfrac1{R_s}$，代码如下

```matlab
s_num = length(a);
wlen = (s_num-1)*Ts*fs+len;%Sb数组长度
for k = 1:s_num
	Sb = Sb + [zeros(1,(k-1)*Ts),a(k)*g,zeros(1,wlen-(k-1)*Ts-len)]; %逐符号成型滤波
end
t = [1:wlen]; %对应时间
```

#### 2.AGWN信道

AGWN信道部份的关键在于正确表达$E_b/n_0$。以下讨论假设$E_b$，$n_0$已分别给定。

对于有卷积码的情况，设卷积编码效率 $R_c$，记编码比特能量$E_{b,c}$，则
$$
\dfrac{E_{b,c}}{n_0}=\dfrac1{R_c}\dfrac{E_b}{n_0}
$$
因此，在波形信道部份，只需将给定的$E_b/n_0$换算成$E_{b,c}/n_0$，就可等效为无信道编码的情况。接下来只讨论无卷积码的情况。

 **信号能量部分：**

成型滤波后$E_{b_0}$的表达式如下
$$
E_{b_0}=\dfrac1M\mathbb{E}\left(\left|a_n\right|^2\right)\int\left|g(t)\right|^2dt
$$
电平映射均采用MPSK且幅度设置为1，理论计算给出$\int\left|g(t)\right|^2dt=R_s$ ，因此$E_{b_0}=\dfrac{R_s}{M}$。现在需要将其提升到给定的$E_b$值，只需对`Sb`乘一个系数$\sqrt{2ME_b/R_s}$，如下

```matlab
Sb = sqrt(M*2*Eb/Rs)*Sb; %修正后的Eb/n0是我们需要的值
```

注意：由于在复基带，比特能量是$2E_b$

**噪声功率部分：**

噪声功率无穷大，但在以采样率$f_s$仿真时，相当于提前做了一个$\dfrac{fs}{2}$低通滤波，最终加在采样点上的噪声功率为$\dfrac{n_0f_s}2$。复基带上则是实、虚部各加功率为$n_0f_s$的噪声。

```matlab
I = real(Sb);
Q = imag(Sb);
S = I.*cos(2*pi*fc*t)-Q.*sin(2*pi*fc*t);%上变频，发送信号实带通波形
Qn = Q + randn(1,length(t))*n1;
In = I + randn(1,length(t))*n1;
Sn = In.*cos(2*pi*fc*t)-Qn.*sin(2*pi*fc*t);%加噪信号实带通波形
Sbn = In + j*Qn; %加噪信号复基带波形
```

#### 3.匹配滤波与采样

```matlab
normFactor = 1/sqrt(M*2*Eb*Ecur); %电平信道匹配因子
h = normFactor * g; %匹配滤波器
R = conv(Sbn,h,'same'); %滤波
sampTime = ([0:s_num-1]*Ts) + 10*Ts + 1;
a_re = R(sampTime);	%采样
```

这里着重讨论`normFactor`：这个因子的作用是，确保最终得到的电平模值期望为$1$，以便后续的电平信道正常完成译码。计算方式如下：无`normFactor`时，采样值的模值期望为
$$
\begin{aligned}
E_a=&A_0(g*h)(t)_{|t=0}\\
=&A_0(g*g)(t)_{|t=0} \\
=&A_0\int (g(t))^2dt\\
=&A_0R_s
\end{aligned}
$$
其中$A_0= \sqrt{2ME_b/R_s}$ 是成型滤波时乘在`g`上的系数，综上有
$$
E_a=\sqrt{2ME_bR_s}
$$
将`normFactor`取为其倒数，即可把采样模值归一化为1。

### 仿真

本部分对于前述传输任务，给出波形信道上的仿真结果。

#### 1.无卷积 传输过程仿真

**待传输信息：**8kB随机比特序列

**参数选取：** $M=1\  \mathbb{bit/symbol}$，$R_s = 1665Hz$，无卷积编码，${E_b}/{n_0}=8dB$，取定$E_b=1$

发射信号与加噪信号（时域波形与功率谱）：

![](C:\学习资料\_编码引论\project2\FoC\仿真结果\sim_11_8dB.jpg)

*注：均用真实频率展示。其中时域仅展示10ms的波形，功率谱加了一定长度的矩形滑动窗。*

**分析**

* 从时域看，噪声功率远远大于信号功率，信号似乎完全被淹没；从功率谱看，有效频段内的信号功率明显高于噪声功率，应有办法区分。
* 功率谱大致呈现出升余弦状，与设计相符

**关于功率谱取值的进一步讨论：**

采用`fft`计算功率谱，代码如下

```matlab
Fs = conv(abs(fft(S)/(length(S))).^2,ones(1,500)/500,'same');
Fs = fftshift(Fs);
ff = ([-length(Fs)/2:length(Fs)/2-1]/length(Fs));
plot(ff*f_real,Fs*f_real); %绘图时，归一化频率转成实际频率
```

我们可以理论验证功率谱取值的正确性：
$$
\int\mathbb{S}(f)df=P=E_sR_s=ME_bR_s
$$
此仿真条件下，右式理论值为0.05。实际对功率谱积分（求和）得到几乎完全相同的结果：

```matlab
>> sum(Fs)
ans =
    0.0499
```

#### 2.有卷积 传输过程仿真

#### 3.误比特率曲线仿真

